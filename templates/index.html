{% extends "base.html" %}
{% block content %}

<div class="container">

  <!-- Search by Barcode -->
  <h2>Search by Barcode</h2>
  <form class="search-form" action="{{ url_for('index') }}" method="POST">
    <input type="text" name="barcode" placeholder="Enter barcode" required>
    <button type="submit" class="btn primary-btn">Lookup</button>
  </form>

  <!-- Search by Product Name -->
  <h2>Search by Product Name</h2>
  <form class="search-form" action="{{ url_for('index') }}" method="POST">
    <input type="text" name="query" placeholder="Enter product name" required>
    <button type="submit" class="btn secondary-btn">Search</button>
  </form>

  <!-- Search Results Grid -->
  {% if search_results %}
  <div class="results-section">
    <h3>Search Results</h3>
    <div class="results-grid">
      {% for product in search_results %}
      <div class="product-card">
        <img src="{{ product.image_front_small_url or url_for('static', filename='img/placeholder.png') }}" alt="Product Image">
        <h4>{{ product.product_name or "Unknown Product" }}</h4>
        <p><strong>Brand:</strong> {{ product.brands or "N/A" }}</p>
        <form action="{{ url_for('index') }}" method="POST" style="margin-top: 10px;">
          <input type="hidden" name="barcode" value="{{ product.code }}">
          <button type="submit" class="btn small-btn">View Details</button>
        </form>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- Detailed Product Information -->
  {% if product_info %}
  <div class="product-info">
    <h3>Product Details</h3>
    <p><strong>Name:</strong> {{ product_info.product_name or 'N/A' }}</p>

    {% if product_info.image_url %}
    <img src="{{ product_info.image_url }}" alt="Product Image" class="product-image">
    {% endif %}

    <p><strong>Brand:</strong> {{ product_info.brands or 'N/A' }}</p>
    <p><strong>Categories:</strong> {{ product_info.categories or 'N/A' }}</p>
    <p><strong>Ingredients:</strong> {{ product_info.ingredients_text or 'Not available' }}</p>
    <p><strong>Allergens:</strong> 
      {% if product_info.allergens %}
        {{ product_info.allergens | replace('en:', '') | replace(',', ', ') }}
      {% else %}
        None listed
      {% endif %}
    </p>
    <p><strong>Nutritional Grade:</strong> {{ product_info.nutrition_grade or 'N/A' }}</p>

    {% if product_info.nutriments %}
    <div class="nutrition-section">
      <h4>Nutrition Facts (per 100g)</h4>
      <table class="nutrition-table">
        {% for key, value in product_info.nutriments.items() %}
        <tr>
          <td>{{ key }}</td>
          <td>{{ value }}</td>
        </tr>
        {% endfor %}
      </table>
    </div>
    {% endif %}
  </div>
  {% endif %}

</div>

{% endblock %}
